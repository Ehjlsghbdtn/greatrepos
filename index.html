<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let ball = { x: 400, y: 500, radius: 20, speedX: 0, speedY: 0 };
let hoop = { x: Math.random() * 600 + 100, y: 100, width: 100, height: 10 };
let isDragging = false;
let touchStart = null;
let score = 0;
let timeLeft = 10;
let throwStrength = 0;

function drawBall() {
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fillStyle = '#FF4500';
    ctx.fill();
    ctx.closePath();
}

function drawHoop() {
    ctx.beginPath();
    ctx.rect(hoop.x, hoop.y, hoop.width, hoop.height);
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 5;
    ctx.stroke();
    ctx.closePath();
}

function drawScoreAndTime() {
    ctx.font = '20px Arial';
    ctx.fillText(`Score: ${score}`, 20, 30);
    ctx.fillText(`Time: ${timeLeft}`, 700, 30);
}

function updateBallPosition() {
    ball.x += ball.speedX;
    ball.y += ball.speedY;
    ball.speedY += 0.5; // Гравитация

    // Отскок от краев экрана
    if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) ball.speedX *= -1;
    if (ball.y < ball.radius || ball.y > canvas.height - ball.radius) ball.speedY *= -1;

    // Попадание в кольцо
    if (
        ball.x > hoop.x &&
        ball.x < hoop.x + hoop.width &&
        ball.y > hoop.y &&
        ball.y < hoop.y + hoop.height
    ) {
        score++;
        timeLeft += 1;
        ball = { x: 400, y: 500, radius: 20, speedX: 0, speedY: 0 };
        hoop.x = Math.random() * 600 + 100;
    }
}

function updateTime() {
    if (timeLeft > 0) timeLeft -= 0.02;
    else endGame();
}

function endGame() {
    alert(`Game over! Final score: ${score}`);
    score = 0;
    timeLeft = 10;
}

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBall();
    drawHoop();
    drawScoreAndTime();
    updateBallPosition();
    updateTime();
    requestAnimationFrame(gameLoop);
}

// Добавляем поддержку touch событий
canvas.addEventListener('mousedown', (e) => {
    if (Math.hypot(e.offsetX - ball.x, e.offsetY - ball.y) < ball.radius) {
        isDragging = true;
        touchStart = { x: e.offsetX, y: e.offsetY };
    }
});

canvas.addEventListener('mousemove', (e) => {
    if (isDragging) {
        drawTrajectory(e.offsetX, e.offsetY);
    }
});

canvas.addEventListener('mouseup', (e) => {
    if (isDragging) {
        throwBall(e.offsetX, e.offsetY);
        isDragging = false;
    }
});

// Поддержка touch-устройств
canvas.addEventListener('touchstart', (e) => {
    const touch = e.touches[0];
    const touchX = touch.clientX - canvas.offsetLeft;
    const touchY = touch.clientY - canvas.offsetTop;
    if (Math.hypot(touchX - ball.x, touchY - ball.y) < ball.radius) {
        isDragging = true;
        touchStart = { x: touchX, y: touchY };
    }
});

canvas.addEventListener('touchmove', (e) => {
    if (isDragging) {
        const touch = e.touches[0];
        const touchX = touch.clientX - canvas.offsetLeft;
        const touchY = touch.clientY - canvas.offsetTop;
        drawTrajectory(touchX, touchY);
    }
});

canvas.addEventListener('touchend', (e) => {
    if (isDragging && touchStart) {
        const touch = e.changedTouches[0];
        const touchX = touch.clientX - canvas.offsetLeft;
        const touchY = touch.clientY - canvas.offsetTop;
        throwBall(touchX, touchY);
        isDragging = false;
    }
});

function drawTrajectory(currentX, currentY) {
    ctx.beginPath();
    ctx.moveTo(ball.x, ball.y);
    ctx.lineTo(currentX, currentY);
    ctx.strokeStyle = 'blue';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.closePath();
}

function throwBall(releaseX, releaseY) {
    ball.speedX = (releaseX - touchStart.x) * 0.1;
    ball.speedY = (releaseY - touchStart.y) * 0.1;
}

gameLoop();
</script>
